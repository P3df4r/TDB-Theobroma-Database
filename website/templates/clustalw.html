<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TDB</title>
  <link rel="stylesheet" href="../static/css/global.css">
  <link rel="stylesheet" href="../static/css/navbar.css">
  <link rel="stylesheet" href="../static/css/blast.css">
  
  <style>
	.blastPageContainer{
		position: relative;
	}
  
  	.outputClustalFmt{
  		width: 100vw;
  		height: 100%;
  		background-color: #FFF;
  		padding: 4.5rem 2rem 3rem;
  		
  		display: none;
  		/*justify-content: center;*/
  		
  		position: fixed;
  		top: 0rem;
  		
  		animation: outputClustalFmtAnimation .5s ease-in-out;
  	}
  	
  	.showOutputClustalFmt{
  		display: flex;
  	}
  	
  	.outputClustalFmtBackButton,
  	.previousResultButton{
  		border: 0;
  		background-color: var(--main-color);
  		color: var(--secondary-color);
  		font-size: 1.5rem;
  		font-weight: bold;
  		padding: 1rem 2.5rem;
  		border-radius: 1rem;
  		cursor: pointer;
  		
  		transition: all .3s ease;
  	}
  	
  	.outputClustalFmtBackButton:hover,
  	.previousResultButton:hover{
  		background-color: var(--green-2);
  	}
  	
  	.outputClustalFmtBackButton{
  		 position: absolute;
  		top: 5rem;
  		left: 2rem;
  	}
  	
  	.previousResultButton{
  		display: none;
  	}
  	
  	.showPreviousResultButton{
  		display: flex;
  	}
  	
  	@keyframes outputClustalFmtAnimation{
  		from{
  			transform: translate(0, 100%);
  		}
  		to{
  			transform: translate(0, 0);
  		}
  	}
  	
  	
  	/*==== SAV ====*/
	::-webkit-scrollbar{
	  width: .7rem;
	  height: .7rem;
	}
	
	/* Barra de scroll */
	::-webkit-scrollbar-thumb{
	  background-color: var(--main-color);
	  border-radius: 4rem;
	}
	
	/* Barra de scroll com hover */
	::-webkit-scrollbar-thumb:hover{
	  background-color: var(--color-bttn);
	}
	
	/*==== sequenceAlignmentViewer ====*/
	.sequenceAlignmentViewer{
	  width: 100%;
	  border-radius: 2rem;
	  background-color: #FFF;
	  box-shadow: 0 4px .3rem #bbbbbb75;
	  
	  padding: 1rem 1rem;
	  margin-top: 5rem;
	  
	  display: flex;
	  flex-direction: column;
	  gap: 1rem;
	  
	  overflow: scroll;
	  
	  border: 1px solid #e3e3e3;
	}
	
	/*==== sequenceContainer ====*/
	.sequenceContainer{
	  display: flex;
	  align-items: center;
	  
	  gap: 2.5rem;
	}
	
	.nome{
	  color: var(--main-color-hover);
	  font-weight: bold;
	  /**/
	  flex: 1;
	}
	
	.sequencia{
		text-wrap: nowrap;
	}
	
	.variasLetras{
	  display: flex;
	  flex: 1;
	}
	
	.variasLetras span{
	  width: 3rem;
	  color: #FFF;
	  
	  /*padding: .5rem 1rem;*/
	 
	  padding: .2rem;
	  font-size: 1.7rem;
	  font-weight: bold;
	
	  display: flex;
	  align-items: center;
	  justify-content: center;
	}
	
	/*==== viewerText ====*/
	.viewerText{
	  width: 100%;
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  justify-content: center;
	  gap: 1rem;
	  padding: 1rem;
	  
	  user-select: none;
	}
	
	.viewerText .ph-dna{
	  color: var(--green-2);
	  font-size: 3rem;
	}
	
	.viewerText h2{
	  color: var(--green-2);
	  text-align: center;
	}
	
	
	/*==== Colors ====*/
	
	.red{
	  background-color: red;
	}
	
	.blue{
	  background-color: blue;
	}
	
	.yellow{
	  background-color: yellow;
	}
	
	.green{
	  background-color: green;
	}
	
	.lightBlue{
	  background-color: rgb(0, 208, 255);
	}
	
	.darkBlue{
	  background-color: rgb(0, 0, 164);
	}
	
	.orange{
	  background-color: rgb(177, 115, 0);
	}
	
	.lightOrange{
	  background-color: rgb(223, 145, 0);
	}
	
	.yellowGreen{
	  background-color: rgb(191, 255, 0);
	}
	
	.lightGreen{
	  background-color: rgb(0, 222, 0);
	}
	
	.lightGreen2{
	  background-color: rgb(0, 186, 0);
	}
	
	.purple{
	  background-color: purple;
	}
	
	.lightPurple{
	  background-color: rgb(174, 0, 174);
	}
	
	.darkPurple{
	  background-color: rgb(47, 0, 141);
	}
	
	.violet{
	  background-color: rgb(214, 93, 214);
	}
	
	.DarkViolet{
	  background-color: rgb(130, 139, 238);
	}
	
	.gray{
	  background-color: rgb(219, 219, 219);
	}
	
	@media screen and (min-width: 917px){
		.sequenceAlignmentViewer{
			align-items: center;
		}
	}
  </style>
  
  <script src="../static/js/navbar.js" defer></script>
  
  <script src="https://unpkg.com/@phosphor-icons/web@2.0.3"></script>
</head>
<body>
  <nav class='navbar'>
    <div class='menuButton'>
      <div class='menuBar1'></div>
      <div class='menuBar2'></div>
      <div class='menuBar3'></div>
    </div>
    <a class="tdbLogo" href="/index.html">
      <figure>
        <img src='../static/icons/database_icon.svg' alt="Ícone do Theobroma DataBase" />
      </figure>
      <h2>TDB</h2>
    </a>
    <ul class='navbarTools'>
      <li>
        <a href="/index.html">
          <img src='../static/icons/home_fill_icon.svg' alt="Ícone de início" />
          Home
        </a>
      </li>
      <li>
        <span class='toolsBttn'>
          <img src='../static/icons/tools_icon.svg' alt="Ícone de ferramentas" />
          Tools
        </span>
        <div class='dropDown'>
          <a href="/blast">
            <img src='../static/icons/genetic_icon.svg' alt="BLAST tool icon " />
            BLAST
          </a>
          <a href="/jbrowse">
            <img src='../static/icons/genetic_icon.svg' alt="JBROWSE tool icon" />
            JBROWSE
          </a>
          <a href="/clustaw">
            <img src='../static/icons/genetic_icon.svg' alt="CLUSTAL tool icon" />
            CLUSTALW
          </a>
		  <a href="/tree">
            <img src='../static/icons/genetic_icon.svg' alt="TREE tool icon" />
           FiloTree
          </a>
        </div>
      </li>
      <li>
        <a href="/download">
          <img src="../static/icons/download_icon.svg" alt="Ícone de download" />
          Download
        </a>
      </li>
      <li>
        <a href="/about">
          <img src='../static/icons/info_icon.svg' alt="Ícone de informações" />
          About
        </a>
      </li>
    </ul>
    <div class='searchBttn'>
      <form class="form-inline" method="POST" id="form-search" action="/search_engine">
        <input class="form-control" data-target="Search-page" type="text" name="search_input" placeholder="Search Gene/Genome" aria-label="Search Gene/Genome/Function">
    	<input class="btn btn-primary" type="submit" value="Search" data-target="search-engine">
      </form>
    </div>
  </nav>

  <section class='blastPageContainer'>
    <div class='pageTitle'>
        <figure>
            <img src='../static/icons/blast_icon.svg' alt="Blast tool page icon" />
        </figure>
        <h1>CLUSTALW</h1>
    </div>
    
    <form method="POST" enctype="multipart/form-data" action="/align">
      <div class="selectWrapper">
        <div class="select">
          <select name="escolhaGenoma" id="genoma">
            <option value="0">Criollo</option>
            <option value="1">Matina</option>
            <option value="2">C174</option>
            <option value="3">C174P</option>
            <option value="4">C1074</option>
            <option value="5">C1074P</option>
            <option value="6">16S Chr2</option>
          </select>
        </div>
      </div>
      <div class="modos_clustal">
        <div class="select_clustal">
            <select name="escolha_clustal" id="escolha">
                <option value="0">DNA</option>
                <option value="1">Protein</option>
            </select>
        </div>
      </div>
      <textarea class="textarea fastaFormat" placeholder="FASTA format" id="input-manual" name="input_manual"></textarea>
      <div class="uploadFileBox">
        <input type="file" name="file_clustal">
      </div>
      <input class="sendForm" type="submit" value="Alignment">
    </form>
	<br>
	<br>
	<br>
	<div class="outputClustalFmt">
		<button type='button' class="outputClustalFmtBackButton">
			voltar
		</button>
		



        
      <div class="sequenceAlignmentViewer">
	    <div class="viewerText">
	      <i class="ph ph-dna"></i>
	      <h2>Visualize aqui o alinhamento</h2>
	    </div>
	    <pre>
          {{ output_clustal_fmt }}
        </pre>
	  </div>
	</div>
	
	<div>
		<button type='button' class="previousResultButton">
			Resultado anterior
		</button>
	</div>
  </section>
  
  
  <script>
	const outputClustalFmt = document.querySelector('.outputClustalFmt');
	const outputClustalFmtBackButton = document.querySelector('.outputClustalFmtBackButton');
	const previousResultButton = document.querySelector('.previousResultButton');
  
  	let output_clustal_fmt = `{{ output_clustal_fmt }}`;
	
	if(output_clustal_fmt.length > 0){
		outputClustalFmt.classList.add('showOutputClustalFmt');
		previousResultButton.classList.add('showPreviousResultButton');
	};
	
	outputClustalFmtBackButton.addEventListener('click', () => {
		outputClustalFmt.classList.remove('showOutputClustalFmt');
	});
	
	previousResultButton.addEventListener('click', () => {
		outputClustalFmt.classList.add('showOutputClustalFmt');
	});
	

	const sequenceAlignmentViewerContainer = document.querySelector('.sequenceAlignmentViewer');
	
	const displayAlignment = document.querySelector('.displayAlignment');
	
	
	
	const colors = {
	  S: 'red',
	  A: 'yellowGreen',
	  T: 'orange',
	  C: 'yellow',
	  V: 'lightGreen',
	  N: 'purple',
	  Y: 'lightBlue',
	  M: 'lightGreen2',
	  D: 'red',
	  E: 'lightPurple',
	  H: 'blue',
	  G: 'lightOrange',
	  K: 'darkPurple',
	  L: 'green',
	  P: 'orange',
	  '-': 'gray',
	  Q: 'violet',
	  R: 'darkBlue',
	  W: 'lightBlue',
	  F: 'green',
	  I: 'green',
	};
	
	// Guarda o tamanho do elemento que contem o maior nome
	let maiorTamanhoNome = 0
	
	// Função principal
	function sequenceAlignmentViewer(sequencesText){
	  // Divide o texto "sequencesText" pelo separador ">"
	  let sequencesArr = sequencesText.split('&gt;');
	
	  let formattedSequencesArr = [];
	    
	  sequencesArr.forEach((seq, i) => {
	    if(i !== 0){
	      let sequence = seq.split('\n');
	  
	      let auxArr = [];
	      auxArr.push(sequence[0].trim());
	      auxArr.push(sequence[1].trim());
	  
	      formattedSequencesArr.push(auxArr);
	    };
	  });

	  if(sequenceAlignmentViewerContainer.hasChildNodes()){
	    while(sequenceAlignmentViewerContainer.hasChildNodes()){
	      sequenceAlignmentViewerContainer
	        .removeChild(sequenceAlignmentViewerContainer.firstChild);
	    };
	
	    maiorTamanhoNome = 0;
	    contDelayNome = 0;
	
	    formattedSequencesArr.forEach(seq => {
	      displaySequencesHtml(seq);
	    });
	  } else{
	    formattedSequencesArr.forEach(seq => {
	      displaySequencesHtml(seq);
	    });
	  }
	
	  definirTamanhoNome();
	};
	
	// Mostra a sequencia no HTML
	function displaySequencesHtml(sequence){
	  console.log(sequence);
	
	  // sequenceContainer
	  let sequenceContainer = document.createElement('div');
	  sequenceContainer.classList.add('sequenceContainer');
	
	  // nome
	  let nome = document.createElement('p');
	  nome.classList.add('nome');
	  nome.innerText = sequence[0];
	  sequenceContainer.appendChild(nome);
	  
	  // sequencia
	  let sequencia = document.createElement('bold');
	  sequencia.classList.add('sequencia');
	  sequencia.innerText = sequence[1];
	  
	  sequenceContainer.appendChild(sequencia);
	
	  //console.log(sequenceContainer);
	
	  sequenceAlignmentViewerContainer.appendChild(sequenceContainer);
	
	
	
	  // Pega o tamanho do maior nome  
	  let posNome = nome.getBoundingClientRect();
	
	  if(posNome.width > maiorTamanhoNome){
	    maiorTamanhoNome = posNome.width;
	  };
	};
	
	// Defini o tamanho dos elementos da classe "nome"
	function definirTamanhoNome(){
	  let allNomeElements = document.querySelectorAll('.nome');
	
	  allNomeElements.forEach(element => {
	    element.style.width = `${maiorTamanhoNome*1.5}px`;
	  });
	};
  </script>
</body>
</html>
